<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.mvc.mapper.ReplyMapper">

	<!--CRUD-->
	<insert id="insert">
	insert into tbl_reply (rno, bno, gno, replyer, reply)
	values (seq_reply.nextval, #{bno}, seq_reply.currval, #{replyer}, #{reply})
	</insert>

	<select id="read" resultType="org.mvc.domain.ReplyVO">
	select * from tbl_reply where rno = #{rno}
	</select>

	<update id="update">
	update tbl_reply set reply = #{reply}, updatedate = sysdate where rno = #{rno}
	</update>

	<update id="delete">
	update tbl_reply set deleteyn = 'y' where rno = #{rno}
	</update>
	
	<!--LIST-->
	<select id="list" resultType="org.mvc.domain.ReplyVO">
	select * from 
	(<![CDATA[
		select * from 
		(select /*+INDEX_ASC (tbl_reply pk_reply)*/ rownum rn, rno, bno, gno, replyer, reply, deleteyn, regdate, updatedate 
		from tbl_reply where deleteyn = 'n' and rno>0 and bno=#{bno}) reply where rn <= #{cri.page} * 10) reply 
		where rn > (#{cri.page} - 1) * 10]]>
	</select>

	<select id="total" resultType="int">
	select count(rno) from tbl_reply where deleteyn = 'n' and bno = #{bno}
	</select>
</mapper>
